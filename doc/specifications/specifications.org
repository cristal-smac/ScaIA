#+TITLE Technical specification ScaIA
#+AUTHOR Maxime MORGE
#+STARTUP: showall 

#+BEGIN_SRC latex :imagemagick yes :border 1em :packages '(("" "tikz")) :exports results :file activityBehaviour.pdf
\usetikzlibrary{automata,arrows}

\begin{tikzpicture}[>=triangle 45]
\node (Available) at (0,10) [state,initial]  {Available};
\node (Raising) at (10,10) [state] {Raising};
\node (Casting) at (10,0)  [state] {Casting};
\node (Firing) at (10,-10) [state] {Firing};   

\path[->] 
(Available) edge [loop above] node {$Propose(i) \wedge g=\emptyset \Rightarrow i!Accept$} ()
            edge [above,out=45,in=135]  node {$q_a > |g| \Rightarrow query(g); query(g+i) $} (Raising)
            edge [above,out=-90,in=180, looseness=0] node {$q_a \leq |g| \Rightarrow querySub(g+i)) $} (Casting)
(Raising) edge [loop above] node {$Propose(j) \wedge stash()$} ()
          edge [loop right] node[align=center] {$Reply(g',a,u) \wedge nbW\neq 1 \Rightarrow$\\$u(g')+=u; nbW--$} ()
          edge [above,out=-135,in=-45]  node[align=center] {$Reply(g',a,u) \wedge nbW= 1 \wedge u(g+i) \geq u(g) \Rightarrow$\\$i!Accept; g+=i; unStashAll()$} (Available)
          edge [right] node[align=center] {$Reply(g',a,u) \wedge nbW= 1 \wedge u(g+i) < u(g) \Rightarrow$\\$querySub(g+i)$} (Casting)
(Casting) edge [right, out=330, in=300,looseness=8] node {$Propose(j) \Rightarrow stash()$} (Casting)
          edge [right, out=25, in=55, looseness=8] node[align=center] {$Reply(g',a,u) \wedge nbW\neq 1 \Rightarrow$\\$u(g')+=u; nbW--$} (Casting)
          edge [below,out=-180,in=-90, looseness=1] node[align=center] {$Reply(g',a,u) \wedge nbW= 1 \wedge i \notin Best \Rightarrow$\\$j!Reject ;unStashAll()$} (Available)
          edge [right] node[align=center] {$Reply(g',a,u) \wedge nbW= 1 \wedge i \in Best \Rightarrow$\\$ g-best!Withdraw$} (Firing)
(Firing) edge [loop below] node {$Propose(j) \wedge stash()$} ()
         edge [loop right] node[align=center] {$Confirm \wedge nbC\neq 1 \Rightarrow$\\$nbC--$} ()
         edge [below,out=-180,in=-90,looseness=1] node[align=center] {$Confirm \wedge nbC= 1 \Rightarrow$\\$i!Accept; g=best ;unStashAll()$} (Available)
;
\end{tikzpicture}
#+END_SRC

#+RESULTS:
#+BEGIN_LaTeX
[[file:activityBehaviour.pdf]]
#+END_LaTeX

[[file:activityBehaviour.pdf]]
